<html>
	<head>
		<title>Robot Control</title>
		<link rel="stylesheet" href="materialize.css">
		<script src="materialize.js"></script>
		<script src="virtualjoystick.js"></script>
		<style>
			#container {
				height		: 300px;
				overflow	: hidden;
				padding		: 0;
				margin		: 0;
				-webkit-user-select	: none;
				-moz-user-select	: none;
				background-color:#b2dfdb;
				position:static;
			}
			#total {
				width		: 100%;
				height		: 100%;
				overflow	: hidden;
				padding		: 0;
				margin		: 0;
				-webkit-user-select	: none;
				-moz-user-select	: none;
			}
			#buttons {
				width		: 50%;
				height		: 100%;
				overflow	: hidden;
				padding		: 0;
				margin		: 0;
				-webkit-user-select	: none;
				-moz-user-select	: none;
				}
		</style>
</head>
<body class="teal lighten-5">
	<img src="logo.png" style="width:100px;"></img>
	<span style="height:10%; font-size:200%;"><b>Archelon Robot Control</b></span>
	<div class="row">
	<div class="col s6">
			<p>Camera Switch</p>
			<button class="waves-effect waves-light btn" onclick = "switchCam(1);">&larr;</button>
			<button class="waves-effect waves-light btn" onclick = "switchCam(-1);">&rarr;</button>
			<p>Claw</p>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('C');">Open</button>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('c');">Close</button>
			<p>Claw Rotation</p>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('{');">&larr;CCW</button>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('^');">STOP</button>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('}');">CW&rarr;</button>
			<p>Agar</p>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('A');">On</button>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('a');">Off</button>
			<p>Laser</p>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('L');">On</button>
			<button class="waves-effect waves-light btn" onclick = "buttonclick('l');">Off</button>
			<span id="result"></span>
			<form action="#"><p class="range-field">
				<input type="range" id="slider" min="-50"max="50" style = "-webkit-appearance: slider-vertical; /* WebKit */
    width: 5px;
    height: 200px;
    padding: 0 5px;"/>
			</p></form>
			<div id="Outputxy"> X:0 Y:0 </div>
			<div id="Outputz"> Z: 0</div>

	</div>
<div class="col s6">
		<img id="cam"></img>
		<div id="container">	</div>
</div>	</div>
	<script>
		x = new WebSocket("ws://"+location.host+"/websock")
		function buttonclick(txt) { x.send(txt) }
		x.onmessage=function(msgEvent){
			console.log("Loading camera data: "+btoa(msgEvent.data));
			document.getElementById("cam").src="data:image/jpeg;base64,"+btoa(msgEvent.data);
		}

		var joystick = new VirtualJoystick({
			container	: document.getElementById('container'),
			mouseSupport	: true,
			limitStickTravel: true,
			stickRadius	: 50
		});
		var slider = document.getElementById('slider');
		var outputxyText = document.getElementById('Outputxy');
		var outputzText = document.getElementById('Outputz');
		var camnum = 0;
		function switchCam(n) {
			camnum+=n;
			if(n>2){n=0;}
			if(n<0){n=2;}
		}
		var brk = 0;
		setInterval(function(){
			if (joystick._pressed){
				buttonclick('X'+Math.round(joystick.deltaX()));
				buttonclick('Y'+Math.round(joystick.deltaY()));
				outputxyText.innerHTML = "X: " + Math.round(joystick.deltaX()) + "Y: " + Math.round(-1*joystick.deltaY());
			}
			buttonclick('S'+Math.round(slider.value));
			outputzText.innerHTML = "Z: " + slider.value;
		}, 1000);
		document.getElementById("cam").src="/cam/"+camnum+"?"+brk;
		brk++;
		document.getElementById("cam").onload = function() {
			document.getElementById("cam").src="/cam/"+camnum+"?"+brk;
			brk++;
		}
	</script>
</body>
</html>
